"use strict";(self.webpackChunkflutter_sdk_docs=self.webpackChunkflutter_sdk_docs||[]).push([[657],{3905:function(e,a,t){t.d(a,{Zo:function(){return u},kt:function(){return d}});var n=t(7294);function i(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){i(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function s(e,a){if(null==e)return{};var t,n,i=function(e,a){if(null==e)return{};var t,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||(i[t]=e[t]);return i}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=n.createContext({}),c=function(e){var a=n.useContext(l),t=a;return e&&(t="function"==typeof e?e(a):o(o({},a),e)),t},u=function(e){var a=c(e.components);return n.createElement(l.Provider,{value:a},e.children)},m={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},p=n.forwardRef((function(e,a){var t=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(t),d=i,f=p["".concat(l,".").concat(d)]||p[d]||m[d]||r;return t?n.createElement(f,o(o({ref:a},u),{},{components:t})):n.createElement(f,o({ref:a},u))}));function d(e,a){var t=arguments,i=a&&a.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=p;var s={};for(var l in a)hasOwnProperty.call(a,l)&&(s[l]=a[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var c=2;c<r;c++)o[c]=t[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,t)}p.displayName="MDXCreateElement"},5896:function(e,a,t){t.r(a),t.d(a,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return u},default:function(){return p}});var n=t(7462),i=t(3366),r=(t(7294),t(3905)),o=["components"],s={title:"Realm Database",sidebar_position:4},l=void 0,c={unversionedId:"realm-database",id:"realm-database",title:"Realm Database",description:"Realm Database is a reactive, object-oriented, cross-platform, mobile",source:"@site/docs/realm-database.md",sourceDirName:".",slug:"/realm-database",permalink:"/flutter-sdk-docs/docs/realm-database",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/realm-database.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"Realm Database",sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Quick Start",permalink:"/flutter-sdk-docs/docs/quick-start"}},u=[{value:"Native Database Engine",id:"native-database-engine",children:[],level:2},{value:"Realm Files",id:"realm-files",children:[],level:2},{value:"Copy-on-Write: The Secret Sauce of Data Versioning",id:"copy-on-write-the-secret-sauce-of-data-versioning",children:[],level:2},{value:"Memory Mapping",id:"memory-mapping",children:[],level:2},{value:"Compaction",id:"compaction",children:[],level:2},{value:"ACID Compliance",id:"acid-compliance",children:[],level:2},{value:"Queries",id:"queries",children:[],level:2},{value:"Indexes",id:"indexes",children:[],level:2},{value:"Schemas",id:"schemas",children:[],level:2}],m={toc:u};function p(e){var a=e.components,t=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,n.Z)({},m,t,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Realm Database is a reactive, object-oriented, cross-platform, mobile\ndatabase:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Reactive"),": query the current state of data and subscribe to state\nchanges like the result of a query, or even changes to a single\nobject."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Object-oriented"),": organizes data as objects, rather than rows,\ndocuments, or columns."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Cross-platform"),": use the same database on iOS, Android, Linux,\nmacOS, or Windows. Just define a schema for each SDK you use."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Mobile"),": designed for the low-power, battery-sensitive, real-time\nenvironment of a mobile device.")),(0,r.kt)("p",null,"Realm Database is an alternative to\n",(0,r.kt)("a",{parentName:"p",href:"https://www.sqlite.org/index.html"},"SQLite")," and ",(0,r.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/coredata"},"Core\nData"),"."),(0,r.kt)("p",null,"This page explains some of the implementation details and inner workings\nof Realm Database. This page is for you if you are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"a developer interested in learning more about Realm Database"),(0,r.kt)("li",{parentName:"ul"},"comparing Realm Database with competing databases")),(0,r.kt)("p",null,"This explanation begins with a deep dive into database internals,\ncontinues with a high-level introduction to some of the features of\nRealm Database."),(0,r.kt)("h1",{id:"database-internals"},"Database Internals"),(0,r.kt)("p",null,"Realm Database uses a completely unique database engine, file format,\nand design. This section describes some of the high-level details of\nthose choices."),(0,r.kt)("h2",{id:"native-database-engine"},"Native Database Engine"),(0,r.kt)("p",null,"Realm Database is an entire database written from scratch in C++,\ninstead of building on top of an underlying database engine like SQLite.\nRealm Database's underlying storage layer uses ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/B%2B_tree"},"B+\ntrees")," to organize objects. As\na result, Realm Database controls optimizations from the storage level\nall the way up to the access level."),(0,r.kt)("p",null,"Realm Database stores data in ",(0,r.kt)("strong",{parentName:"p"},"realms"),": collections of heterogeneous\nrealm objects. You can think of each realm as a database. Each object in\na realm is equivalent to a row in a SQL database table or a MongoDB\ndocument. Unlike SQL, realms do not separate different object types into\nindividual tables."),(0,r.kt)("p",null,"Realm Database stores objects as groups of property values. We call this\ncolumn-based storage. This means that queries or writes for individual\nobjects can be slower than row-based storage equivalents when unindexed,\nbut querying a single field across multiple objects or fetching multiple\nobjects can be much faster due to spatial locality and in-CPU vector\noperations."),(0,r.kt)("p",null,"Realm Database uses a\n",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Zero-copy"},"zero-copy")," design to make\nqueries faster than an ORM, and often faster than raw SQLite."),(0,r.kt)("h2",{id:"realm-files"},"Realm Files"),(0,r.kt)("p",null,"Realm Database persists data in files saved on device storage. The\ndatabase uses several kinds of file:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"realm files"),', suffixed with "realm", e.g. ',(0,r.kt)("inlineCode",{parentName:"li"},"default.realm"),":\ncontain object data."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"lock files"),', suffixed with "lock", e.g. ',(0,r.kt)("inlineCode",{parentName:"li"},"default.realm.lock"),":\nkeep track of which versions of data in a realm are actively in use.\nThis prevents realm from reclaiming storage space that is still used\nby a client application."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"note files"),', suffixed with "note", e.g. ',(0,r.kt)("inlineCode",{parentName:"li"},"default.realm.note"),":\nenable inter-thread and inter-process notifications."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"management files"),', suffixed with "management", e.g.\n',(0,r.kt)("inlineCode",{parentName:"li"},"default.realm.management"),": internal state management.")),(0,r.kt)("p",null,"Realm files contain object data with the following data structures:\nGroups, Tables, Cluster Trees, and Clusters. Realm Database organizes\nthese data structures into a tree structure with the following form:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The top level, known as a Group, stores object metadata, a\ntransaction log, and a collection of Tables."),(0,r.kt)("li",{parentName:"ul"},"Each class in the realm schema corresponds to a Table within the\ntop-level Group."),(0,r.kt)("li",{parentName:"ul"},"Each Table contains a Cluster Tree, an implementation of a B+ tree."),(0,r.kt)("li",{parentName:"ul"},"Leaves on the Cluster Tree are called Clusters. Each contains a\nrange of objects sorted by key value."),(0,r.kt)("li",{parentName:"ul"},"Clusters store objects as collections of columns."),(0,r.kt)("li",{parentName:"ul"},"Each column contains data for a single property for multiple\ninstances of a given object. Columns are arrays of data with\nuniformly sized values."),(0,r.kt)("li",{parentName:"ul"},"Columns store data in one of the following sizes: 1, 2, 4, 8, 16,\n32, or 64 bits. Each column uses one value size, determined by the\nlargest value.")),(0,r.kt)("p",null,"Since pointers refer to memory addresses, objects written to persistent\nfiles cannot store references as pointers. Instead, realm files refer to\ndata using the offset from the beginning of the file. We call this a\nref. As Realm Database uses memory mapping to read and write data,\ndatabase operations translate these refs from offsets to memory pointers\nwhen navigating database structures."),(0,r.kt)("h2",{id:"copy-on-write-the-secret-sauce-of-data-versioning"},"Copy-on-Write: The Secret Sauce of Data Versioning"),(0,r.kt)("p",null,"Realm Database uses a technique called ",(0,r.kt)("strong",{parentName:"p"},"copy-on-write"),", which copies\ndata to a new location on disk for every write operation instead of\noverwriting older data on disk. Once the new copy of data is fully\nwritten, the database updates existing references to that data. Older\ndata is only garbage collected when it is no longer referenced or\nactively in use by a client application."),(0,r.kt)("p",null,"Because of copy-on-write, older copies of data remain valid, since all\nof the references in those copies still point to other valid data. Realm\nDatabase leverages this fact to offer multiple versions of data\nsimultaneously to different threads in client applications. Most\napplications tie data refreshes to the repaint cycle of the looper\nthread that controls the UI, since data only needs to refresh as often\nas the UI does. Longer-running procedures on background threads, such as\nlarge write operations, can work with a single version of data for a\nlonger period of time before committing their changes."),(0,r.kt)("h2",{id:"memory-mapping"},"Memory Mapping"),(0,r.kt)("p",null,"Writes use ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Memory-mapped_file"},"memory\nmapping")," to avoid\ncopying data back and forth from memory to storage. Accessors and\nmutators read and write to disk via memory mapping. As a result, object\ndata is never stored on the stack or heap of your app. By default, data\nis memory-mapped as read-only to prevent accidental writes."),(0,r.kt)("p",null,"Realm Database uses operating system level paging, trusting each\noperating system to implement memory mapping and persistence better than\na single library could on its own."),(0,r.kt)("h2",{id:"compaction"},"Compaction"),(0,r.kt)("p",null,"Realm Database automatically reuses free space that is no longer needed\nafter database writes. However, realm files never shrink automatically,\neven if the amount of data stored in your realm decreases significantly.\nCompact your realm to optimize storage space and decrease file size if\npossible."),(0,r.kt)("p",null,"You should compact your realms occasionally to keep them at an optimal\nsize. You can do this manually, or by configuring your realms to compact\non launch. However, Realm Database reclaims unused space for future\nwrites, so compaction is only an optimization to conserve space\non-device."),(0,r.kt)("h2",{id:"acid-compliance"},"ACID Compliance"),(0,r.kt)("p",null,"Realm Database guarantees that transactions are ",(0,r.kt)("inlineCode",{parentName:"p"},"ACID <ACID>")," compliant. This means that all committed write operations are\nguaranteed to be valid and that clients don't see transient states in\nthe event of a system crash. Realm Database complies with ACID with the\nfollowing design choices:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Atomicity_(database_systems)"},"Atomicity"),":\ngroups operations in transactions and rolls back all operations in a\ntransaction if any of them fail."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Consistency_(database_systems)"},"Consistency"),":\navoids data corruption by validating changes against the schema. If\nthe result of any write operation is not valid, Realm cancels and\nrolls back the entire transaction."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Isolation_(database_systems)"},"Isolation"),":\nallows only one writer at a time. This ensures thread safety between\ntransactions."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Durability_(database_systems)"},"Durability"),":\nwrites to disk immediately when a transaction is committed. In the\nevent of an app crash, for example, changes are not lost or\ncorrupted.")),(0,r.kt)("h1",{id:"features"},"Features"),(0,r.kt)("p",null,"Realm Database supports many popular database features."),(0,r.kt)("h2",{id:"queries"},"Queries"),(0,r.kt)("p",null,"You can query Realm Database using platform-native queries or a raw\nquery language that works across platforms."),(0,r.kt)("h2",{id:"indexes"},"Indexes"),(0,r.kt)("p",null,"Indexes are implemented as trees containing values of a given property\ninstead of a unique internal object key. This means that indexes only\nsupport one column, and thus only one property, at a time."),(0,r.kt)("h2",{id:"schemas"},"Schemas"),(0,r.kt)("p",null,"Every realm object has a schema. That schema is defined via a native\nobject in your SDK's language. Object schemas can include embedded lists\nand relations between object instances."),(0,r.kt)("p",null,"Each realm uses a versioned schema. When that schema changes, you must\ndefine a migration to move object data between schema versions. Additive\nschema changes happen automatically, but your SDK may require you to\nincrease the local schema version to begin using the updated schema in\nyour app. Destructive changes require a migration function. See your\nSDK's documentation for more information on migrations."))}p.isMDXComponent=!0}}]);